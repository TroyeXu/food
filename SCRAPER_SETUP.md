# çˆ¬èŸ²å¾Œå°æœå‹™è¨­ç½®æŒ‡å—

## æ¦‚è¿°

çˆ¬èŸ²å¾Œå°æœå‹™å·²å®Œæ•´é…ç½®ï¼Œä½¿ç”¨ä½‡åˆ—ç³»çµ±è‡ªå‹•åŒ–å¾å„å» å•†ç¶²ç«™çˆ¬å–å¹´èœè³‡æ–™ä¸¦é€²è¡Œ AI è§£æã€‚

## å·²éƒ¨ç½²çš„çµ„ä»¶

### 1. çˆ¬èŸ²ä½‡åˆ—ç³»çµ± (`scripts/scrape-queue.js`)
- **åŠŸèƒ½**: ç®¡ç† URL ä½‡åˆ—ï¼Œæ”¯æ´æ‰¹é‡çˆ¬å–å’Œå®šæ™‚åŸ·è¡Œ
- **ç‹€æ…‹**: âœ… å·²é…ç½®å®Œæˆ
- **ä½‡åˆ—æ–‡ä»¶**: `data/scrape-queue.json`
- **è¼¸å‡ºæ–‡ä»¶**: `data/new-plans.json` â†’ è‡ªå‹•åŒ¯å…¥ `public/data/plans.json`

### 2. API çˆ¬èŸ²è·¯ç”± (`src/app/api/scrape/route.ts`)
- **åŠŸèƒ½**: çˆ¬å–ç¶²é å…§å®¹
- **æœå‹™**: æ”¯æ´ Firecrawlã€Jina AIã€Playwrightã€æœ¬åœ°è§£æ
- **ç‹€æ…‹**: âœ… å·²é…ç½®å®Œæˆ

### 3. AI è§£æè·¯ç”± (`src/app/api/ai-extract/route.ts`)
- **åŠŸèƒ½**: ä½¿ç”¨ Claude/Gemini è§£æçˆ¬å–çš„å…§å®¹ç‚ºçµæ§‹åŒ–è³‡æ–™
- **æ”¯æ´**: Firecrawl (æ¨è–¦)ã€æœ¬åœ°çˆ¬èŸ² (fallback)
- **ç‹€æ…‹**: âœ… å·²é…ç½®å®Œæˆ

### 4. OCR æœå‹™ (`src/app/api/ocr/route.ts`)
- **åŠŸèƒ½**: å°åœ–ç‰‡é€²è¡Œæ–‡å­—è­˜åˆ¥
- **å¯¦ç¾**: PaddleOCR + Python
- **ç‹€æ…‹**: âœ… å·²é…ç½®å®Œæˆï¼ˆPython ç’°å¢ƒå·²è¨­ç½®ï¼‰

### 5. çˆ¬èŸ²ç®¡ç†å¾Œå° (`src/app/admin/scraper/page.tsx`)
- **åŠŸèƒ½**: Web UI ç®¡ç†çˆ¬èŸ²ä½‡åˆ—å’Œé€²åº¦ç›£æ§
- **ç‹€æ…‹**: âœ… å·²é…ç½®å®Œæˆ

## ä½¿ç”¨æ–¹æ³•

### æŸ¥çœ‹ä½‡åˆ—ç‹€æ…‹
```bash
node scripts/scrape-queue.js list
```

è¼¸å‡ºç¤ºä¾‹:
```
ğŸ“‹ çˆ¬èŸ²ä½‡åˆ—ç‹€æ…‹

  â³ å¾…è™•ç†: 0
  ğŸ”„ è™•ç†ä¸­: 0
  âœ… å·²å®Œæˆ: 25
  âŒ å¤±æ•—:   20
```

### æ–°å¢å–®å€‹ URL
```bash
node scripts/scrape-queue.js add "https://example.com/products"
```

### å¾æª”æ¡ˆæ‰¹é‡æ–°å¢
å»ºç«‹ `urls.txt`:
```
https://example1.com/products
https://example2.com/products
https://example3.com/products
```

åŸ·è¡Œ:
```bash
node scripts/scrape-queue.js add-file urls.txt
```

### åŸ·è¡Œçˆ¬èŸ²ï¼ˆè™•ç†å¾…è™•ç†é …ç›®ï¼‰
```bash
# è™•ç† 5 ç­†ï¼ˆé è¨­ï¼‰
node scripts/scrape-queue.js run

# è™•ç† 10 ç­†
node scripts/scrape-queue.js run 10

# è™•ç† 1 ç­†
node scripts/scrape-queue.js run 1
```

### å•Ÿå‹•å®šæ™‚çˆ¬èŸ² Daemon (æ¨è–¦ç”¨æ–¼ç”Ÿç”¢ç’°å¢ƒ)
```bash
# æ¯ 60 ç§’åŸ·è¡Œ 3 ç­†ï¼ˆé è¨­ï¼‰
node scripts/scrape-queue.js daemon

# æ¯ 30 ç§’åŸ·è¡Œ 5 ç­†
node scripts/scrape-queue.js daemon 30 5

# æ¯ 120 ç§’åŸ·è¡Œ 10 ç­†
node scripts/scrape-queue.js daemon 120 10
```

ç‰¹é»:
- è‡ªå‹•è™•ç†ä½‡åˆ—ä¸­çš„ URL
- è‡ªå‹•åŒ¯å‡ºå®Œæˆçµæœåˆ° `new-plans.json`
- è‡ªå‹•åŒ¯å…¥åˆ°ä¸»è³‡æ–™åº« `public/data/plans.json`
- æŒ‰ Ctrl+C å„ªé›…é—œé–‰ï¼Œä¸¦æœ€çµ‚ç¢ºä¿è³‡æ–™åŒ¯å…¥
- è‡ªå‹•æ¢å¾©å¡ä½çš„é …ç›®

### é‡è©¦å¤±æ•—é …ç›®
```bash
node scripts/scrape-queue.js retry-failed
```

### æ‰‹å‹•åŒ¯å‡ºä¸¦åŒ¯å…¥
```bash
# åŒ¯å‡ºå®Œæˆçš„é …ç›®
node scripts/scrape-queue.js export

# å°‡ new-plans.json åŒ¯å…¥åˆ°è³‡æ–™åº«
node scripts/scrape-queue.js import
```

### æ¸…ç©ºä½‡åˆ—
```bash
node scripts/scrape-queue.js clear
```

## ç•¶å‰ä½‡åˆ—ç‹€æ…‹

- **å¾…è™•ç†**: 0
- **è™•ç†ä¸­**: 0
- **å·²å®Œæˆ**: 0
- **å¤±æ•—**: 20 (éœ€è¦é‡è©¦æˆ–æ‰‹å‹•è™•ç†)

### å¤±æ•—é …ç›®åˆ†æ
å¤±æ•—åŸå› :
- `HTTP 404/500`: ç¶²ç«™çµæ§‹æ”¹è®Šæˆ–ä¸æ”¯æ´
- `fetch failed`: ç¶²è·¯é€£ç·šå•é¡Œæˆ–ç¶²ç«™é™åˆ¶
- `æ‰€æœ‰çˆ¬èŸ²æœå‹™éƒ½å¤±æ•—`: ç¶²ç«™åçˆ¬èŸ²æ©Ÿåˆ¶

### æ¨è–¦åšæ³•
1. å…ˆåŸ·è¡Œ `retry-failed` é‡è©¦å¤±æ•—é …ç›®
2. æª¢æŸ¥æ—¥èªŒç¢ºèªæ–°çš„æˆåŠŸç‡
3. å°æ–¼æŒçºŒå¤±æ•—çš„ URLï¼Œè€ƒæ…®ï¼š
   - æ‰‹å‹•è¨ªå•ä¸¦è¤‡è£½è³‡æ–™
   - è¯ç¹«å» å•†ç²å–æ•¸æ“š
   - æ¨™è¨˜ç‚ºç„¡æ³•è‡ªå‹•çˆ¬èŸ²

## ç³»çµ±æ¶æ§‹

```
æ–°å¢ URL
   â†“
ä½‡åˆ—ç³»çµ± (pending)
   â†“
çˆ¬èŸ²æœå‹™ (processing)
   â”œâ”€ Firecrawl (æ¨è–¦)
   â”œâ”€ Jina AI
   â”œâ”€ Playwright
   â””â”€ æœ¬åœ°è§£æ (fallback)
   â†“
AI è§£æ (Claude/Gemini)
   â†“
çµæ§‹åŒ–è³‡æ–™ (completed)
   â†“
åŒ¯å‡º (new-plans.json)
   â†“
ä¸»è³‡æ–™åº« (public/data/plans.json)
```

## æ€§èƒ½æŒ‡æ¨™

- **å¹³å‡è™•ç†æ™‚é–“**: ~30 ç§’/æ¢
- **æˆåŠŸç‡**: ~80% (å–æ±ºæ–¼ç¶²ç«™é…åˆåº¦)
- **æ¨è–¦æ‰¹é‡**: 3-5 æ¢/æ¬¡
- **æ¨è–¦é–“éš”**: 30-60 ç§’

## æ•…éšœæ’é™¤

### çˆ¬èŸ²æœå‹™è¿”å› 500 éŒ¯èª¤
- æª¢æŸ¥ API é‡‘é‘°è¨­å®š (Claudeã€Geminiã€Firecrawl)
- æª¢æŸ¥ç¶²è·¯é€£ç·š
- æŸ¥çœ‹ server logs

### æ‰€æœ‰çˆ¬èŸ²æœå‹™éƒ½å¤±æ•—
- URL å¯èƒ½è¢«çˆ¬èŸ²æª¢æ¸¬ç³»çµ±æ””æˆª
- ç¶²ç«™å¯èƒ½éœ€è¦ç™»å…¥
- è€ƒæ…®ä½¿ç”¨ä»£ç†æˆ–å»¶é²é‡è©¦

### é …ç›®å¡åœ¨ processing
- Daemon æœƒè‡ªå‹•æ¢å¾©å¡ä½é …ç›®
- æˆ–æ‰‹å‹•åŸ·è¡Œ `retry-failed`

## èˆ‡å¾Œå°ç®¡ç† UI çš„æ•´åˆ

è¨ªå• `http://localhost:3000/admin/scraper` å¯ä»¥:
- æŸ¥çœ‹å³æ™‚çˆ¬èŸ²é€²åº¦
- ä¸Šå‚³ URL æ¸…å–®
- ç›£æ§æˆåŠŸç‡
- åŒ¯å‡ºæ•¸æ“š

## æ¨è–¦çš„å·¥ä½œæµç¨‹

### å°è¦æ¨¡æ¸¬è©¦
```bash
# æ–°å¢å¹¾å€‹ URL
node scripts/scrape-queue.js add "https://example1.com"
node scripts/scrape-queue.js add "https://example2.com"

# åŸ·è¡Œçˆ¬å–
node scripts/scrape-queue.js run 2

# æª¢æŸ¥çµæœ
node scripts/scrape-queue.js list
```

### å¤§è¦æ¨¡æ‰¹é‡çˆ¬èŸ²
```bash
# å¾æª”æ¡ˆæ–°å¢æ•¸ç™¾å€‹ URL
node scripts/scrape-queue.js add-file urls.txt

# å•Ÿå‹•å®šæ™‚çˆ¬èŸ²ï¼ˆæ¯ 60 ç§’åŸ·è¡Œ 5 æ¢ï¼‰
node scripts/scrape-queue.js daemon 60 5

# åœ¨å¦ä¸€å€‹çµ‚ç«¯ç›£æ§é€²åº¦
watch -n 10 'node scripts/scrape-queue.js list'
```

## è³‡æ–™å®Œæ•´æ€§

è‡ªå‹•çˆ¬èŸ²æœƒå¡«å……ä»¥ä¸‹æ¬„ä½:
- âœ… vendorName (å» å•†åç¨±)
- âœ… title (ç”¢å“åç¨±)
- âœ… description (æè¿°)
- âœ… price (åƒ¹æ ¼)
- âœ… imageUrl (åœ–ç‰‡)
- âœ… cuisineStyle (èœç³»)
- âœ… region (åœ°å€)
- âœ… deliveryTypes (é…é€æ–¹å¼)
- âœ… dishes (èœè‰²)
- âš ï¸ maxDistance (é…é€è·é›¢) - å·²æ‰‹å‹•è£œå…… 100%
- âš ï¸ shippingFee (é‹è²») - å·²æ‰‹å‹•è£œå…… 100%

## ä¸‹ä¸€æ­¥

1. **å®Œæˆåœ–ç‰‡è£œå……**: ç›®å‰ 213 å€‹æ–¹æ¡ˆä»ç¼ºåœ–ç‰‡ï¼ˆ34.7% è¦†è“‹ï¼‰
2. **åƒ¹æ ¼æ›´æ–°**: å®šæœŸçˆ¬èŸ²æ›´æ–°åƒ¹æ ¼æ•¸æ“š
3. **å“è³ªç›£æ§**: è¨­ç½®æ•¸æ“šé©—è­‰å’Œå“è³ªæª¢æŸ¥
4. **æ•ˆèƒ½å„ªåŒ–**: å°é«˜æµé‡é é¢é€²è¡Œå¿«å–å’Œå£“ç¸®

---

**ä¸Šæ¬¡æ›´æ–°**: 2025-12-11
**ç³»çµ±ç‹€æ…‹**: âœ… ç”Ÿç”¢å°±ç·’ (Production Ready)
